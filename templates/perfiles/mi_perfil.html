{% extends 'base.html' %}
{% load static %}

{% block title %}Mi Perfil - Centro de Padres{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Mi Perfil</h1>

    <!-- Profile Information -->
    <div class="card mb-4">
        <div class="card-header">
            <h2>Información del Perfil</h2>
        </div>
        <div class="card-body">
            <p><strong>Nombre Alumno:</strong> {{ perfil.alumno.nombre }} {{ perfil.alumno.apellido }}</p>
            <p><strong>Curso:</strong> {{ perfil.alumno.curso }}</p>
            <p><strong>Colegio:</strong> {{ perfil.alumno.colegio }}</p>
        </div>
    </div>

    <!-- Payment Concepts -->
    <div class="card mb-4">
        <div class="card-header">
            <h2>Pagos Asociados y Realizados</h2>
        </div>
        <div class="card-body">
            <ul class="list-group mb-3">
                {% for deuda in perfil.deudas %}
                <li class="list-group-item">
                    <h5>{{ deuda.nombre }}</h5>
                    <p><strong>Estado:</strong> {{ deuda.estado_pago }}</p>
                    <p><strong>Monto Total a Cancelar:</strong> ${{ deuda.monto_total|floatformat:0 }}</p>
                    <p><strong>Montos Pagados:</strong> ${{ deuda.monto_pagado|floatformat:0 }}</p>
                    <p><strong>Monto Pendiente:</strong> ${{ deuda.monto_pendiente|floatformat:0 }}</p>
                    {% if deuda.es_pago_en_cuotas %}
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: {{ deuda.porcentaje_pagado }}%;" aria-valuenow="{{ deuda.porcentaje_pagado }}" aria-valuemin="0" aria-valuemax="100">
                            {{ deuda.porcentaje_pagado }}% Pagado
                        </div>
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            <div class="card">
                <div class="card-body bg-light">
                    <h4>Resumen General de Pagos</h4>
                    <p><strong>Total a Pagar por todos los conceptos:</strong> ${{ perfil.total_a_pagar|floatformat:0 }}</p>
                    <p><strong>Total Pagado:</strong> ${{ perfil.total_pagado_general|floatformat:0 }}</p>
                    <p><strong>Monto Pendiente de Pagos:</strong> ${{ perfil.total_pendiente|floatformat:0 }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Section -->
    <div class="card">
        <div class="card-header">
            <h2>Auditoría</h2>
        </div>
        <div class="card-body">
            <ul class="list-group">
                <li class="list-group-item"><strong>Fecha de creación del perfil:</strong> {{ perfil.fecha_creacion }}</li>
                <li class="list-group-item"><strong>Alumno asociado:</strong> {{ perfil.alumno.nombre }} {{ perfil.alumno.apellido }}</li>
                <li class="list-group-item"><strong>Fecha de asociación del alumno:</strong> {{ perfil.fecha_asociacion_alumno }}</li>
                <li class="list-group-item"><strong>Curso y colegio:</strong> {{ perfil.alumno.curso.nombre }} - {{ perfil.alumno.colegio.nombre }}</li>
                {% for item in historial %}
                <li class="list-group-item"><strong>{{ item.fecha }}:</strong> {{ item.descripcion }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
